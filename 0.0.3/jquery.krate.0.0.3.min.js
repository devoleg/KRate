(function(b){methods=b.fn.krate=function(d){elementid=Math.floor(1E4*Math.random());elementid="krateElement"+elementid;var a=b.extend({},d);if(void 0!=a.star&&void 0!=a.rating&&void 0!=a.url){void 0==a["star-disabled"]&&(a["star-disabled"]=a.star);void 0==a["star-hover"]&&(a["star-hover"]=a.star);void 0==a.size&&(a.size=16);void 0==a.best&&(a.best=5);b(this).html("");container=$tmpelement=b('<div id="'+elementid+'"/>').appendTo(this);container.css({width:a.size*a.best+"px",background:"url("+a["star-disabled"]+
") left center repeat-x",height:a.size+"px"});stars=[];$tmpelement=b('<div class="kStars" data-val="'+a.rating+'"/>').appendTo(container);$tmpelement.css({position:"absolute",width:a.size*a.rating+"px",background:"url("+a.star+") left center repeat-x",height:a.size+"px"});zindex=10;for(i=a.best;1<=i;i--)$tmpelement=b('<div class="kDoRate" data-val="'+i+'"/>').appendTo(container),stars[i]=$tmpelement,stars[i].css({"z-index":zindex++,position:"absolute",cursor:"pointer",height:a.size+"px",width:a.size*
i+"px"}),stars[i].hover(function(){b(this).css("background","url("+a["star-hover"]+") left center repeat-x")},function(){b(this).css("background","none")});b("#"+elementid+" .kDoRate").click(function(){element=b(this);val=element.attr("data-val");elementid=element.parent().attr("id");postData={value:val};void 0!=a.data&&(postData=b.extend({},postData,a.data));void 0!=a.before&&a.before.call(element);b.ajax({type:"POST",url:a.url,dataType:"JSON",data:postData,success:function(c){c.rating&&($tmpelement=
b("#"+elementid+" .kStars"),$tmpelement.css({position:"absolute",width:a.size*c.rating+"px",background:"url("+a.star+") left center repeat-x",height:a.size+"px"}),$tmpelement.attr("data-val",c.rating));void 0!=a.after&&a.after.call(element,c)}})})}}})(jQuery);